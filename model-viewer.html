<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>3D Model Viewer</title>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <link rel="stylesheet" href="modelviewer_style.css">
    
    <style>
        /* Styles for touch/interaction optimization */
        #controls, label, button, .glass, .dim { touch-action: manipulation; }
        .hideDim { font: normal 12pt Arial; font-weight: 500; color: white; pointer-events: auto; border-radius: 115px; }
        
        /* Styles for full-screen overlay/iframe handling */
        body.no-scroll { overflow: hidden; position: fixed; width: 100%; height: 100%; top: 0; left: 0; }

        #iframeWrapper {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            display: none; /* Mantido oculto por padrão */
            flex-direction: column; overflow-y: auto;
            -webkit-overflow-scrolling: touch; z-index: 9999;
            justify-content: center; align-items: center;
        }

        #iframeWrapper iframe {
            width: 85vw; height: 71vh; max-width: 546px;
            background-color: white; border: 1px solid #ccc;
            border-radius: 8px; overflow-y: auto;
        }
        
        /* Oculta o overlay de specs por padrão (se não for feito via class externa) */
        .spec-overlay { display: none; }
    </style>
</head>

<body>
  <a-scene>
    <a-assets>
      <a-asset-item id="my-model" src="models/model1.glb"></a-asset-item>
    </a-assets>

    <a-gltf-model
      src="#my-model"
      rotation="0 0 0"  position="0 0 -2"> <a-animation
        attribute="rotation"
        dur="10000"
        fill="forwards"
        to="0 360 0"
        repeat="indefinite">
      </a-animation>
    </a-gltf-model>

    <a-entity light="type: ambient; color: #BBB; intensity: 0.5;"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 1.5;" position="-1 1 1"></a-entity>
    
    <a-entity camera look-controls wasd-controls position="0 2 3"></a-entity>
    
    <a-box 
        position="0 -0.5 0" 
        scale="10 0.1 10" 
        color="#888" 
        shadow>
    </a-box>

  </a-scene>

<script type="module">



        // -------------------------------------------------------------------------
        // 5. LÓGICA DE SOBREPOSIÇÃO DE ESPECIFICAÇÕES (MANTIDA)
        // -------------------------------------------------------------------------
        
        closeSpec.addEventListener('click', () => {
            specOverlay.style.display = 'none';
            iframeWrapper.style.display = 'none';
            modelIframe.src = "";
        });

        closeIframeBtn.addEventListener('click', () => {
            iframeWrapper.style.display = 'none';
            modelIframe.src = '';
        });
        
        // -------------------------------------------------------------------------
        // 6. LÓGICA DE ATIVAÇÃO DO AR E EVENTOS (MANTIDA)
        // -------------------------------------------------------------------------

        let arJustStarted = false;
        let arTimeout = null;

        function startAR() {
            arOverlay.style.display = 'none';
            arJustStarted = false;
            modelViewer.activateAR();
        }

        arButton.addEventListener('click', (event) => {
            if (!modelViewer.canActivateAR) {
                console.log("デバイス/コンテキストで AR がサポートされていません。");
                return;
            }

            if (!arJustStarted) {
                event.preventDefault();
                event.stopPropagation();

                arOverlay.style.display = 'flex';
                arJustStarted = true;
                arTimeout = setTimeout(startAR, 2000);
            }
        });

        arOverlay.addEventListener('click', () => {
            if (arJustStarted) {
                clearTimeout(arTimeout);
                startAR();
            }
        });

        modelViewer.addEventListener('ar-status', (event) => {
            const status = event.detail.status;
            if (status === 'presenting') {
                modelViewer.play({ animationName: 'action' });
                console.log("Forçando animação 'action' no modo AR.");
            }
            if (status === 'not-presenting' || status === 'failed') {
                arOverlay.style.display = 'none';
                arJustStarted = false;
                clearTimeout(arTimeout);
            }
            
            // Lógica de ajuste de câmera e AR Shadow DOM (mantida)
            const shadowRoot = modelViewer.shadowRoot;
            if (shadowRoot) {
                const internalArButton = shadowRoot.querySelector('button[slot="ar-button"]');
                if (internalArButton) {
                    internalArButton.style.display = (status === 'presenting') ? 'none' : '';
                }
            }
        });

        modelViewer.addEventListener('load', () => {
            const size = modelViewer.getDimensions();
            const maxDim = Math.max(size.x, size.y, size.z);
            const suggestedDistance = maxDim * 1.5;
            modelViewer.cameraOrbit = `0deg 75deg ${suggestedDistance}m`;
        });
                
    </script>
    
    <script>
        // Funções para controle de scroll e iframe (não modulares)
        function showModel10() {
            const iframeWrapper = document.getElementById('iframeWrapper');
            iframeWrapper.style.display = 'flex';
            document.body.classList.add('no-scroll');
        }

        function hideIframe() {
            const iframeWrapper = document.getElementById('iframeWrapper');
            iframeWrapper.style.display = 'none';
            document.body.classList.remove('no-scroll');
        }
    </script>
</body>
</html>